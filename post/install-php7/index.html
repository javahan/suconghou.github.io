<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='renderer' content='webkit'><meta name='viewport' content='width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no'>
	<title> &middot; </title>
	<link rel="stylesheet" type="text/css" href="/css/style.min.css">
	<link href="" rel="alternate" type="application/rss+xml" title="" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
	<link rel="shortcut icon" href="/favicon.png">
</head>
<body>
<header class="header">

</header>


<div class="content container">
	<div class="post">
		<h1 class="post-title">
			<a href="javascript:void(0)"> 安装PHP7和NGINX</a>
		</h1>
		<p class="post-date">Fri, Jan 1, 2016</p>
		<div class="post-text">
			 

<h2 id="编译安装nginx:d4cb4e734d41e78905840ce77b949d35">编译安装NGINX</h2>

<p>首先安装一些依赖</p>

<pre><code>yum -y install gcc make autoconf automake install zlib zlib-devel openssl openssl-devel pcre-devel
</code></pre>

<p>编译安装</p>

<pre><code>wget http://nginx.org/download/nginx-1.9.3.tar.gz
tar -zxvf nginx-1.9.3.tar.gz
cd nginx-1.9.3
./configure
make &amp;&amp; make install
</code></pre>

<h2 id="编译安装php7:d4cb4e734d41e78905840ce77b949d35">编译安装PHP7</h2>

<p>最好先<code>yum update</code>一下,再安装以下依赖</p>

<pre><code>yum install -y git wget curl curl-devel gcc gcc-c++ libmarypt cmake libxml2  autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libpng libpng-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses curl openssl-devel gdbm-devel db4-devel libXpm-devel libX11-devel gd-devel gmp-devel readline-devel libxslt-devel expat-devel xmlrpc-c xmlrpc-c-devel
</code></pre>

<p>下载PHP7最新版本,解压,有多重压缩格式可选,其中xz最小</p>

<pre><code>wget http://php.net/distributions/php-7.0.1.tar.xz
xz -d php-7.0.1.tar.xz
tar -xvf php-7.0.1.tar
cd php-7.0.1
</code></pre>

<p>编译之前,可以开启O3编译优化,生成的可执行文件更小,性能更好
<code>export CFLAGS=&quot;-O3&quot;</code>
不添加任何额外扩展,执行编译</p>

<pre><code>./configure --prefix=/tmp --disable-all
</code></pre>

<p>得出的扩展有</p>

<pre><code>[PHP Modules]
Core
ctype
date
dom
fileinfo
filter
hash
iconv
json
libxml
pcre
PDO
pdo_sqlite
Phar
posix
Reflection
session
SimpleXML
SPL
sqlite3
standard
tokenizer
xml
xmlreader
xmlwriter

[Zend Modules]

</code></pre>

<p>包含部分常用扩展的编译</p>

<pre><code>./configure --prefix=/tmp --enable-sockets --enable-zip --enable-mbstring --with-pdo-mysql --with-curl
</code></pre>

<p>得出的扩展有</p>

<pre><code>[PHP Modules]
Core
ctype
curl
date
dom
fileinfo
filter
hash
iconv
json
libxml
mbstring
mysqlnd
pcre
PDO
pdo_mysql
pdo_sqlite
Phar
posix
Reflection
session
SimpleXML
sockets
SPL
sqlite3
standard
tokenizer
xml
xmlreader
xmlwriter
zip

[Zend Modules]

</code></pre>

<p>功能更全的编译</p>

<pre><code>export CFLAGS=&quot;-O3&quot;
./configure --prefix=/usr/local --with-config-file-path=/etc --enable-opcache --enable-fpm --enable-sockets --enable-ftp --enable-bcmath --enable-pcntl --enable-posix --enable-zip --enable-mbstring --with-iconv --with-pdo-mysql --with-curl --with-mcrypt --with-gd  --with-openssl

make &amp;&amp; make install
</code></pre>

<p>其中部分步骤可能需要root权限</p>

<h3 id="可能出现的错误:d4cb4e734d41e78905840ce77b949d35">可能出现的错误</h3>

<p>1.curl未安装
执行</p>

<pre><code>yum install curl-devel
</code></pre>

<p>或者</p>

<pre><code>sudo apt-get install curl libcurl3 libcurl3-dev
</code></pre>

<p>然后再次尝试编译</p>

<p>2.需要安装libcrytpt</p>

<pre><code>wget ftp://mcrypt.hellug.gr/pub/crypto/mcrypt/attic/libmcrypt/libmcrypt-2.5.7.tar.gz
</code></pre>

<p>安装：</p>

<pre><code>tar -zxvf libmcrypt-2.5.7.tar.gz
cd libmcrypt-2.5.7
mkdir -p /usr/local/libmcrytpt
./configure prefix=/usr/local/libmcrytpt/
make &amp;&amp; make install
</code></pre>

<p>然后重新编译,设定编译参数mcrypt指定路径:
<code>--with-mcrypt=/usr/local/libmcrytpt/</code></p>

<p>提示: make 可使用多核提升编译性能
用make -j带一个参数，可以把项目在进行并行编译，比如在一台双核的机器上，完全可以用<code>make -j4</code>，让make最多允许4个编译命令同时执行，这样可以更有效的利用CPU资源。</p>

<p>-O这个选项控制所有的优化等级。使用优化选项会使编译过程耗费更多的时间，并且占用更多的内存，尤其是在提高优化等级的时候。
-O2是推荐的优化等级,O3是最高等级。如果编译软件出现错误，请先检查是否启用了-O3</p>

<h2 id="安装mariadb:d4cb4e734d41e78905840ce77b949d35">安装MariaDB</h2>

		</div>
	</div>
</div>
	<footer class="footer">
		<div class="footer-nav">
			<ul>
				<li><a href="/post/">归档</a></li>
				<li><a href="/">专题</a></li>
				<li><a href="/life/">生活</a></li>
				<li><a href="/about/">关于</a></li>
			</ul>
		</div>
	</footer>
	<script type="text/javascript" src="/js/main.min.js" data-no-instant></script>
</body>
</html>


