<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="generator" content="Hugo 0.19" />
	<meta charset="UTF-8">
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='renderer' content='webkit'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no'>
	<meta name='description' content='记录学习的点点滴滴'>
	<meta name='keywords' content='前端,PHP,GO,编程博客'>
	<title>苏苏的博客 &middot; 苏苏的博客</title>
	<link rel="stylesheet" type="text/css" href="/css/style.min.css">
	<link href="http://blog.suconghou.cn/index.xml" rel="alternate" type="application/rss+xml" title="苏苏的博客" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
	<link rel="shortcut icon" href="/favicon.png">
</head>
<body>
<header class="header">
	<div class="header-main">
		<a href="/"><img src="/img/avatar.jpg" class="header-avatar"></a>
		<h1>苏苏的博客</h1>
		<p class="sub-title">简约至极</p>
		<ul class="contact">
			<a href="https://github.com/suconghou" target="_blank"><i class="fa fa-github"></i></a>
			<a href="javascript:music.show(1)"><i class="fa fa-music"></i></a>
		</ul>
	</div>
</header>

<aside></aside>

<div class="content container">
	<div class="posts">
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/use-crontab-in-your-server/"> Crontab与自动备份</a>
			</h1>
			<p class="post-date">Tue, Jan 12, 2016</p>
			<div class="post-text">
				

<h2 id="crontab使用">Crontab使用</h2>

<p><code>crontab -l</code> 查看当前用户的crontab列表
使用<code>crontab -e</code>开始编辑规则</p>

<pre><code>基本格式 :
*　　*　　*　　*　　*　　command
分　 时 　日 　月　 周　 命令

* 第1列表示分钟1～59 每分钟用*或者*/1表示
* 第2列表示小时1～23（0表示0点）
* 第3列表示日期1～31
* 第4列表示月份1～12
* 第5列标识号星期0～6（0表示星期天）
* 第6列要运行的命令
</code></pre>

<p>禁止Crontab产生邮件:
在crontab末尾加上<code>&gt; /dev/null 2&gt;&amp;1</code> 或者 <code>&gt; &amp;&gt; /dev/null</code></p>

<p>例如</p>

<pre><code>0 1 5 10 * /path/to/script.sh &gt; /dev/null 2&gt;&amp;1
0 1 5 10 * /path/to/script.sh &gt; &amp;&gt; /dev/null
</code></pre>

<p>你也可以将<code>/dev/null</code>换成你想要存储日志的文件地址</p>

<h2 id="定时备份数据库">定时备份数据库</h2>

<p>先写好shell脚本存入<code>/home/cron1.sh</code></p>

<pre><code>user=&quot;root&quot;
pass=&quot;root&quot;
host=&quot;127.0.0.1&quot;
port=&quot;3306&quot;
dbs=&quot;db1 db2 db3&quot;
dir=&quot;/data/backup/&quot;

nowDate=`date '+%Y%m%d'`
nowTime=`date '+%H%M'`
backupdir=$dir$nowDate
timeold=`date -d &quot;-1 week&quot; +%Y%m%d`
delold=$dir$timeold
if [ ! -d $backupdir ]; then
  mkdir -p $backupdir
fi
if [ -d $delold ]; then
  rm -rf $delold
fi
for i in $dbs
	do
		backupFile=$backupdir/$i-$nowTime.sql
		mysqldump -u$user -p$pass -h$host -P$port --databases $i &gt; $backupFile
		xz $backupFile
	done

</code></pre>

<p>然后定时任务<code>crontab -e</code> 每5个小时备份一次数据库.</p>

<pre><code>0 */5 * * * sh /home/cron1.sh
</code></pre>

<p>使用此脚本建议每20个小时以内备份一次数据库,此脚本保留最近7天备份,删除过期备份</p>

<h2 id="增量备份数据库">增量备份数据库</h2>

<p>先写好shell脚本存入<code>/home/cron2.sh</code></p>

<pre><code>user=&quot;root&quot;
pass=&quot;root&quot;
host=&quot;127.0.0.1&quot;
port=&quot;3306&quot;
storedb=&quot;backup&quot;
backup=&quot;db1.table1 db1.table2&quot;

mysql -u$user -p$pass -h$host -P$port -e &quot;create database if not exists $storedb&quot;
for i in $backup
	do
		table=${i##*.}
		sql=&quot;create table if not exists $storedb.$table like $i;replace into $storedb.$table  select * from $i ;&quot;
		mysql -u$user -p$pass -h$host -P$port -e &quot;$sql&quot;
	done

</code></pre>

<p>数据表从源数据库中增量备份至备份数据库中的同名数据表</p>

<pre><code>0 */20 * * * sh /home/cron2.sh
</code></pre>

<p>每20个小时增量备份一次</p>

<h2 id="更高级的文件实时同步">更高级的文件实时同步</h2>

<p><code>Mac</code>上可以使用<code>fswatch + rsync</code>进行实时同步</p>

<p>首先安装<code>fswatch</code>,<code>rsync</code>应该是自带了</p>

<p><code>brew install fswatch</code></p>

<p>监视目录输出有变动的文件 <code>fswatch -0 /tmp | xargs -0 -n 1 echo $1</code></p>

<p><strong>文件变化自动同步函数</strong></p>

<pre><code>sync1()
{
    dir=/data/project/21textv3/
    while true
    do
        rsync -arvuzpt --progress --exclude=&quot;.git&quot; /data/project/21textv3/  root@172.168.1.3:/data/web/21textv3/
        echo &quot;start morniting folder $dir&quot;
        fswatch -1 $dir
        sleep 2
    done
}
</code></pre>

<h3 id="全功能文件备份脚本">全功能文件备份脚本</h3>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/improve-mysqldb/"> MySQL性能优化</a>
			</h1>
			<p class="post-date">Mon, Jan 11, 2016</p>
			<div class="post-text">
				

<h2 id="配置文件">配置文件</h2>

<p>配置文件一般放在<code>/etc/my.cnf</code> 或者 <code>/etc/mysql/my.cnf</code></p>

<p>默认的配置文件示例存放于<code>/usr/share/mysql</code></p>

<p>各个文件适配不同内存的配置</p>

<table>
<thead>
<tr>
<th>文件</th>
<th>内存大小</th>
</tr>
</thead>

<tbody>
<tr>
<td>my-small.cnf</td>
<td>&lt;= 64M 不经常开启mysql</td>
</tr>

<tr>
<td>my-medium.cnf</td>
<td>32M–64M 经常其他程序搭配mysql</td>
</tr>

<tr>
<td>my-large.cnf</td>
<td>512M</td>
</tr>

<tr>
<td>my-huge.cnf</td>
<td>1G-2G</td>
</tr>

<tr>
<td>my-innodb-heavy-4G.cnf</td>
<td>4GB 使用InnoDB</td>
</tr>
</tbody>
</table>

<p>使用<code>SHOW VARIABLES</code>来查看系统参数,通过<code>SHOW STATUS</code>来判断系统状态</p>

<p>show 命令还有很多用途</p>

<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>

<tbody>
<tr>
<td>show databases 或show tables from database_name</td>
<td>显示mysql中所有数据库的名称</td>
</tr>

<tr>
<td>show tables</td>
<td>显示当前数据库中所有表的名称</td>
</tr>

<tr>
<td>show columns from table_name from database_name</td>
<td>显示表中列名称</td>
</tr>

<tr>
<td>show grants for user_name</td>
<td>显示一个用户的权限，显示结果类似于grant命令</td>
</tr>

<tr>
<td>show table status</td>
<td>显示当前使用或者指定的database中的每个表的信息。<br>信息包括表类型和表的最新更新时间。</td>
</tr>

<tr>
<td>show index from table_name</td>
<td>显示表的索引</td>
</tr>

<tr>
<td>show status</td>
<td>显示一些系统特定资源的信息,例如,正在运行的线程数量</td>
</tr>

<tr>
<td>show variables</td>
<td>显示系统变量的名称和值</td>
</tr>

<tr>
<td>show processlist</td>
<td>显示系统中正在运行的所有进程，也就是当前正在执行的查询。<br>大多数用户可以查看他们自己的进程，但是如果他们拥有process权限，<br>就可以查看所有人的进程，包括密码</td>
</tr>

<tr>
<td>show engies</td>
<td>显示安装以后可用的存储引擎和默认引擎</td>
</tr>

<tr>
<td>show innodb status</td>
<td>显示innoDB存储引擎的状态</td>
</tr>

<tr>
<td>show logs</td>
<td>显示BDB存储引擎的日志</td>
</tr>

<tr>
<td>show warnings</td>
<td>显示最后一个执行的语句所产生的错误、警告和通知</td>
</tr>

<tr>
<td>show errors</td>
<td>只显示最后一个执行语句所产生的错误</td>
</tr>
</tbody>
</table>

<h2 id="小内存优化">小内存优化</h2>

<p>依据<code>my-small.cnf</code>为模板</p>

<p>主要指标:存储引擎,key_buffer_size,table_cache,max_connections,thread_concurrency,query_cache,thread_stack</p>

<p><strong>存储引擎</strong>:
如果不使用 BDB table 和 InnoDB table 的话，加入下面2行关闭不需要的表类型很有必要，关闭 innodb 可以省下大量内存，虽然 InnoDB 好处多多但是在一个64MB的 VPS 上并不能体现出来，并且很占内存。</p>

<p><strong>key_buffer_size</strong>:
用来缓存 tables keys 和 indexes，增加这个值可以更好的处理索引，读和写都需要索引,这里设置成16K足够了.优化性能需要<code>key_reads / key_read_requests</code>应该尽可能的低，至少是1:100，1:1000更好,使用<code>show status like 'key_%';</code>查看</p>

<p><strong>table_cache</strong>:
(5.1.3及以后版本又名TABLE_OPEN_CACHE) 所有线程打开的表的数量，增加值可以增大 MySQL 的文件描述符数量，避免频繁的打开表，原始 my-small.cnf 中 table_cache 设置成4有点小，一个 wordpress 的页面通常会涉及到10个左右的表，其他的程序比如 Drupal，MediaWiki 会涉及到更多，将table_cache改为8。</p>

<p><strong>max_connections</strong>:
数据库最大的连接数量，可以根据自己博客/网站的访问量来定这个值,如果博客/网站经常出现：Too many connections 错误的信息说明需要增大 max_connections 的值.</p>

<p><strong>thread_concurrency</strong>:
最大并发线程数，通常设置为 CPU核数量×2，在 VPS 宿主机上如果服务器有2颗物理 CPU，而每颗物理 CPU 又支持 H.T 超线程（一个处理器上整合了两个逻辑处理器单元），所以实际取值为4 × 2 ＝ 8。
如果我们在优化 php.ini 的时候设置了同时只有2个 php-cgi 运行的话，那么我们也应该只设置2个 MySQL 线程同时运行,设置过大导致线程之间的频繁切换。</p>

<p><em>这个参数在mysql 5.6.1中已经被标记为过时，在5.7.2版本的mysql中被移除</em></p>

<p><strong>query_cache</strong>:
对于博客/新闻网站来说，用得最多的就是查询，所以需要加入 query cache 的设置。query_cache_size 是执行查询所使用的缓冲大小。
query_cache_limit指定单个查询能够使用的缓冲区大小，缺省为1M,结果集超过这个大小将不会被缓存。</p>

<p>与查询缓存有关的参数还有query_cache_type、query_cache_limit、query_cache_min_res_unit。</p>

<p>query_cache_type指定是否使用查询缓存，可以设置为0、1、2,分别代表了off、on、demand,如果是0，那么query cache 是关闭的。如果是1，那么查询总是先到查询缓存中查找，除非使用了sql_no_cache。如果是2，那么，只有使用 sql_cache的查询，才会去查询缓存中查找.</p>

<p>query_cache_limit指定单个查询能够使用的缓冲区大小，缺省为1M。</p>

<p>query_cache_min_res_unit是在4.1版本以后引入的，它指定分配缓冲区空间的最小单位，缺省为4K。</p>

<p>检查状态值Qcache_free_blocks，如果该值非常大，则表明缓冲区中碎片很多，这就表明查询结果都比较小，此时需要减小 query_cache_min_res_unit。</p>

<p><strong>thread_stack</strong>:
每个线程被创建的时候,mysql分配给它的内存,每个连接使用一个线程,用来存放每个线程的标识信息，如线程id，线程运行时环境等。默认294912(288KB)</p>

<p><strong>sort_buffer_size</strong>:
每个需要排序的线程分配的缓冲区大小，增加该值可以加速 order by 和 group by 的操作。注意：该参数是以每个连接分配内存，也就是说，如果有16个连接，sort_buffer_size 为 64K，那么实际分配的内存为：16 × 64K = 1MB。如果设置的缓存大小无法满足需要，MySQL 会将数据写入磁盘来完成排序。因为磁盘操作和内存操作不在一个数量级，所以 sort_buffer_size 对排序的性能影响很大。</p>

<p><strong>read_buffer_size</strong>:
顺序读取数据时的缓冲区大小，与 sort_buffer_size 一样，该参数分配的内存也是以每连接为单位的。
当需要顺序读取数据的时候，如无法使用索引的情况下的全表扫描，全索引扫描等。在这种时候，MySQL 按照数据的存储顺序依次读取数据块，每次读取的数据快首先会暂存在 read_buffer_size 中，当 buffer 空间被写满或者全部数据读取结束后，再将 buffer 中的数据返回给上层调用者，以提高效率。</p>

<p><strong>read_rnd_buffer_size</strong>:
随机读取数据时的缓冲区大小，与顺序读相对应。</p>

<p><strong>net_buffer_size</strong>:
用来存放客户端连接线程的连接信息和返回客户端的结果集的缓存大小。当 MySQL 接到请求后，产生返回结果集时，会在返回给请求线程之前暂存在在这个缓存中，等积累到一定大小的时候才开始向客户端发送，以提高网络效率。不 过，net_buffer_size 所设置的仅仅只是初始大小，MySQL 会根据实际需要自行申请更多的内存，但最大不会超过 max_allowed_packet。</p>

<p>skip-locking用来避免 MySQL 外部锁定，减少出错几率，增强稳定性。</p>

<p><strong>thread_cache_size 优化配置</strong></p>

<p>Thread_Cache是mysql自己维护的连接池,将空闲的连接线程放在连接池中,而不是立即销毁.这样的好处就是,当又有一个新的请求的时候,mysql不会立即去创建连接 线程,而是先去Thread_Cache中去查找空闲的连接线程,如果存在则直接使用,不存在才创建新的连接线程.</p>

<p>thread_cache_size为连接池里最大连接线程数,在短连接的应用中Thread_Cache的功效非常明显,因为在应用中数据库的连接和创建是非常频繁的,如果不使用 Thread_Cache那么消耗的资源是非常可观的!在长连接中虽然带来的改善没有短连接的那么明显,但是好处是显而易见的.但并不是越大越好大了反而浪费资源
依据内存</p>

<pre><code>1G  ---&gt; 8
2G  ---&gt; 16
3G  ---&gt; 32
4G  ---&gt; 64
</code></pre>

<p><code>show variables like 'thread%';show variables like &quot;max_connections&quot;;show status like '%connections%';show status like 'thread%';</code></p>

<p>表3中<code>Connections</code>表示服务器总共服务了多少次连接,<code>Max_used_connections</code>为实际达到的最大并发连接数</p>

<p>表4中<code>Threads_cached</code>是处于连接池中的连接数(休眠的),从表1可以知道连接池允许的最大数量(<code>thread_cache_size</code>)</p>

<p><code>Threads_connected</code>为当前的连接数,也可以从<code>show full processlist;</code>得知当前的连接数,他的最大值即为<code>Max_used_connections</code></p>

<p><code>Threads_running</code>为此时刻正在进行SQL操作的线程,这个值必定是小于等于<code>Threads_connected</code></p>

<p><code>Threads_created</code>为总共执行了多少次创建线程的操作,该数定大于等于<code>Max_used_connections</code>,一个线程创建后用于服务,客户端断开后并不会被销毁,而是放入连接池(只有连接池的数量大于设定值才会被抛弃),当创建的时候也会检查连接池内有没有,没有才会创建新的.</p>

<p>配置项<code>max_connections</code>为允许的最大并发连接数,也可以依据<code>Max_used_connections</code>作为参考,增加该值不会占用系统资源,只有实际使用到的才会占用,但设置过小会出现<code>Too many connections</code>,默认值为100,须大于<code>Max_used_connections</code>,根据网站的并发量来设定.</p>

<p>每一个连接都需要一个线程服务,每个线程初始分配<code>thread_stack</code>字节的内存,连接池的利用率为</p>

<pre><code>Thread_Cache_Hit=(Connections-Thread_created)/Connections*100%
</code></pre>

<p>即尽量减少线程创建操作.</p>

<p><code>show variables like '%timeout%';</code></p>

<p><code>wait_timeout</code>参数有时也是什么有用,该值为客户端已连接但是未活动,最多等待的秒数,超过此时间将主动断开连接.默认是28800(8小时)</p>

<p>执行<code>show full processlist;</code>可以查看所有连接的状态及空闲时间等.</p>

<p>大量长期<code>Sleep</code>的连接,也是在白白消耗内存,该数量被记为<code>Threads_connected</code>,如果大量创建连接而又不断开不使用,会导致改值增加,达到<code>max_connections</code>上限后会报错<code>too many connections</code></p>

<p>要改变他,要同时设置interactive_timeout和wait_timeout才会生效</p>

<p>以上: 64M VPS数据库配置</p>

<pre><code>skip-bdb
skip-innodb

key_buffer_size = 16K
table_cache = 8

thread_stack = 64K

max_connections = 16
thread_cache_size = 8
thread_concurrency = 2

query_cache_type = 1
query_cache_size = 4M
query_cache_limit = 128K
query_cache_strip_comments = 1

sort_buffer_size = 64K
read_buffer_size = 256K
read_rnd_buffer_size = 256K
net_buffer_length = 2K
skip-locking

wait_timeout=3600
interactive_timeout=3600

max_allowed_packet = 8M

</code></pre>

<p>为性能的优化配置</p>

<pre><code>innodb_buffer_pool_size = 128M
tmp_table_size=64M
key_buffer_size=256M
read_buffer_size=4M
read_rnd_buffer_size=16M
sort_buffer_size=32M
join_buffer_size = 32M
bulk_insert_buffer_size = 32M
myisam_sort_buffer_size = 128M
max_allowed_packet = 32M
</code></pre>

<p>如果你的服务器内存较大(4G或更多),专门来跑mysql,可设置key_buffer_size为内存的一半
<code>key_buffer_size = 2048M</code></p>

<p>连接的并发量不大,还有多余内存可以加大join_buffer_size和sort_buffer_size</p>

<pre><code>sort_buffer_size = 64M
join_buffer_size = 64M
</code></pre>

<h3 id="packet-for-query-is-too-large">Packet for query is too large</h3>

<p><code>show variables like '%max%'</code></p>

<p>当update或者insert的内容过大时,<code>max_allowed_packet</code>的值过小,会引起sql异常,需要改大;其默认值为1048576(1M)，</p>

<p>修改<code>my.cnf</code>  <code>max_allowed_packet = 100M</code></p>

<p>或者零时动态设置 <code>set global max_allowed_packet = 104857600;</code></p>

<p>查看是否生效,零时修改一般断开后重新连接即可生效. <code>show variables like '%max_allowed_packet%';</code></p>

<h2 id="数据库优化">数据库优化</h2>

<p>查看query_cache相关配置, 默认这个开关是关闭的,就是禁止使用query_cache
query_cache_type 为0,是关闭的</p>

<p>查看当前的配置 <code>show variables like '%query_cache%';</code></p>

<p>单独查询一个可以使用 <code>select @@query_cache_type;</code></p>

<pre><code>+------------------------------+----------+
| Variable_name                | Value    |
+------------------------------+----------+
| have_query_cache             | YES      |
| query_cache_limit            | 262144   |
| query_cache_min_res_unit     | 4096     |
| query_cache_size             | 33554432 |
| query_cache_strip_comments   | OFF      |
| query_cache_type             | ON       |
| query_cache_wlock_invalidate | OFF      |
+------------------------------+----------+
</code></pre>

<p>上述开启<code>query_cache</code> 32MB</p>

<p>(OFF)如果设置为0，那么可以说，你的缓存根本就没有用，相当于禁用了。</p>

<p>(ON)如果设置为1，将会缓存所有的结果，除非你的select语句使用SQL_NO_CACHE禁用了查询缓存。</p>

<p>(DEMAND)如果设置为2，则只缓存在select语句中通过SQL_CACHE指定需要缓存的查询。</p>

<p><code>query_cache_size</code>为0,没有分配缓存空间,如果配置了<code>query_cache_size = 4M</code>,这里会显示具体的字节</p>

<p>查看配置及运行的状态 <code>show global variables like '%query_cache%';show global status like '%Qcache%';</code></p>

<pre><code>+-------------------------+----------+
| Variable_name           | Value    |
+-------------------------+----------+
| Qcache_free_blocks      | 1        |
| Qcache_free_memory      | 26444248 |
| Qcache_hits             | 159619   |
| Qcache_inserts          | 27496    |
| Qcache_lowmem_prunes    | 0        |
| Qcache_not_cached       | 180      |
| Qcache_queries_in_cache | 6922     |
| Qcache_total_blocks     | 13850    |
+-------------------------+----------+
</code></pre>

<p>如果<code>Qcache_lowmem_prunes</code>的值非常大，则表明经常出现缓冲不够的情况</p>

<p>如果<code>Qcache_hits</code>的值也非常大，则表明查询缓存使用非常频繁，此时需要增加缓冲大小；</p>

<p>如果<code>Qcache_hits</code>的值不大，则表明你的查询重复率很低，这种情况下使用查询缓存反而会影响效率，那么可以考虑不用查询缓存。</p>

<p>此外，在SELECT语句中加入<code>SQL_NO_CACHE</code>可以明确表示不使用查询缓存。</p>

<blockquote>
<p>查询缓存碎片率 = Qcache_free_blocks / Qcache_total_blocks * 100%</p>
</blockquote>

<p>如果查询缓存碎片率超过20%，可以用FLUSH QUERY CACHE整理缓存碎片，或者试试减小query_cache_min_res_unit，如果你的查询都是小数据量的话.</p>

<blockquote>
<p>查询缓存利用率 = (query_cache_size – Qcache_free_memory) / query_cache_size * 100%</p>
</blockquote>

<p>查询缓存利用率在25%以下的话说明query_cache_size设置的过大，可适当减小;查询缓存利用率在80%以上而且Qcache_lowmem_prunes &gt; 50的话说明query_cache_size可能有点小，要不就是碎片太多。</p>

<blockquote>
<p>查询缓存命中率 = Qcache_hits / ( Qcache_hits + Qcache_inserts ) * 100%</p>
</blockquote>

<p>命中率越高,效果越好</p>

<p>要开启<code>Query Cache</code>可以执行如下,注意<code>Query Cache</code>对于读多写少的场景才会有优势</p>

<pre><code>SET GLOBAL query_cache_type = 1;
SET GLOBAL query_cache_size = 16777216;
SET GLOBAL query_cache_limit = 262144;
SET GLOBAL query_cache_strip_comments = 1;
</code></pre>

<blockquote>
<p>query_cache_type:开启缓存</p>

<p>query_cache_size:总的缓存大小16Mb</p>

<p>query_cache_limit:结果集超过256KB则不缓存</p>
</blockquote>

<h2 id="各个数据库引擎对比">各个数据库引擎对比</h2>

<p>主要讨论引擎: MyISAM存储引擎 InnoDB存储引擎 Memory存储引擎</p>

<h3 id="myisam存储引擎">MyISAM存储引擎</h3>

<p>支持B-tree/FullText/R-tree索引类型
锁级别是表锁,表锁的开销小，加锁快;锁粒度大，发生锁冲突的概率较高，并发度低；表锁适合查询
不支持事务性，也不支持外键。</p>

<blockquote>
<p>并发不高，不需要支持事务,需要进行全文搜索,读次数大于写次数,适合数据量不是特别大并发不太高的大部分场合</p>
</blockquote>

<h3 id="innodb存储引擎">InnoDB存储引擎</h3>

<p>支持事务性，支持回滚,支持Hash/B-tree索引类型
锁级别是行锁，行锁在锁定上带来的消耗大于表锁，但是在系统并发访问量较高时，InnoDB整体性能远高于MyISAM。
InnoDB的索引不仅缓存索引本身，也缓存数据，所以InnoDB需要更大的内存。</p>

<blockquote>
<p>表数据量超过千万，高并发,频繁更新大字段,安全性和可用性要求高,更适合与大并发大数据量的场合，除了支持事务，在高并发时行级锁的优势就会发挥出来。</p>
</blockquote>

<h3 id="memory存储引擎">Memory存储引擎</h3>

<p>内存级的存储引擎，它将所有数据都存储在内存中，所以它能够存储的数据量是比较小的
Memory的锁级别和MyISAM一样，是表锁；并且不支持事务性。</p>

<blockquote>
<p>适合与性能要求高数据量小的地方，和缓存的效果类似。</p>

<p>innodb查询表的行数需要全表扫描，速度会非常慢，查询1千万行数据的表最多时要6、7s,而myisam因为保存了总行数是极快的。
在一个进程操作的情况下，myisam的更新和查询速度都会稍快于innodb。memory引擎插入和查询修改的速度都极快，但支持的数据量有限,不支持BLOB/TEXT数据类型,适用于单表几万行数据.</p>

<p>MEMORY表最大值受系统变量 max_heap_table_size 限制，默认为16MB，要改变MEMORY表大小限制，需要改变max_heap_table_size 的值。
MEMORY表写入性能不如InnoDB,读取优于Redis, 更多相关阅读 <a href="https://www.v2ex.com/t/303137">https://www.v2ex.com/t/303137</a></p>
</blockquote>

<h3 id="锁">锁</h3>

<blockquote>
<p>读锁：读操作时增加锁，叫共享锁，S-lock特征是阻塞其他客户端的写操作，不阻塞读操作</p>

<p>写锁：写操作时增加锁，叫独占锁或排他锁，X-lock特征是阻塞其他客户端的读、写操作</p>
</blockquote>

<h3 id="锁定粒度-范围">锁定粒度（范围）</h3>

<blockquote>
<p>行级：提升并发性，锁定开销大</p>

<p>表级：不利于并发性，锁定开销小</p>
</blockquote>

<p><code>show global status like '%cost%';</code> 查看上一次查询的代价</p>

<p><code>show global variables like 'long_query_time';</code> 查看长查询设定的时间</p>

<p><code>show global status like 'slow_queries';</code> &ndash;查看查询时间超过long_query_time秒的查询的个数。</p>

<h3 id="查看最近执行的sql">查看最近执行的sql</h3>

<p>1) If general mysql logging is enabled then we can check the queries in the log file or table based what we have mentioned in the config. Check what is enabled with the following command</p>

<p>mysql&gt; show variables like &lsquo;general_log%&lsquo;;
mysql&gt; show variables like &lsquo;log_output%&lsquo;;
If we need query history in table then</p>

<p>Execute SET GLOBAL log_output = &lsquo;TABLE&rsquo;;
Execute SET GLOBAL general_log = &lsquo;ON&rsquo;;
Take a look at the table mysql.general_log</p>

<p>If you prefer to output to a file:</p>

<p>SET GLOBAL log_output = &ldquo;FILE&rdquo;; which is set by default.
SET GLOBAL general_log_file = &ldquo;/path/to/your/logfile.log&rdquo;;
SET GLOBAL general_log = &lsquo;ON&rsquo;;
2) We can also check the queries in the .mysql_history file cat ~/.mysql_history</p>

<h3 id="ibdata1文件过大">ibdata1文件过大</h3>

<ol>
<li>需要指定<code>innodb_file_per_table</code>参数,单独保存每个表的数据,否则MySQL的数据都会存放在ibdata1文件里，文件只增加不减小,时间久了这个文件就会变的非常大。</li>
</ol>

<p><code>show variables like '%innodb%';</code>查看目前innodb的配置</p>

<p>需要给<code>my.cnf</code>添加一行<code>innodb_file_per_table</code>,记得这个需要在<code>[mysqld]</code>段下面</p>

<ol>
<li>可能有长时间执行但未提交的事务.</li>
</ol>

<p>解决方法可参见 <a href="http://blog.fens.me/mysql-ibdata1/">http://blog.fens.me/mysql-ibdata1/</a></p>

<h2 id="mysql导出数据">mysql导出数据</h2>

<p>命令行下具体用法如下：  mysqldump -u用戶名 -p密码 -d 數據库名 表名 脚本名;</p>

<p>1、导出數據库為dbname的表结构（其中用戶名為root,密码為dbpasswd,生成的脚本名為db.sql）
mysqldump -uroot -pdbpasswd -d dbname &gt;db.sql;</p>

<p>2、导出數據库為dbname某张表(test)结构
mysqldump -uroot -pdbpasswd -d dbname test&gt;db.sql;</p>

<p>3、导出數據库為dbname所有表结构及表數據（不加-d）
mysqldump -uroot -pdbpasswd  dbname &gt;db.sql;</p>

<p>4、导出數據库為dbname某张表(test)结构及表數據（不加-d）
mysqldump -uroot -pdbpasswd dbname test&gt;db.sql;</p>

<p>5.导出数据中dbname多张表（test1,test2,test3）结构及表数据用用空格隔开</p>

<p>mysqldump -uroot -pdbpasswd dbname test1 test2 test3&gt;db.sql;</p>

<p>导出多个数据库,使用 mysqldump -uroot -pdbpassword &ndash;databases db1 db2</p>

<p><strong>使用gzip压缩</strong></p>

<p>导出时: <code>mysqldump -uroot -pdbpasswd dbname | gzip &gt; backupfile.sql.gz</code></p>

<p>导入时: <code>gunzip &lt; backupfile.sql.gz | mysql -uroot -pdbpasswd dbname</code></p>

<p><strong>使用xz压缩</strong></p>

<p>导出时: <code>mysqldump -uroot -pdbpasswd dbname | xz &gt; backupfile.sql.xz</code></p>

<p>导入时: <code>unxz -c backupfile.sql.xz | mysql -uroot -pdbpasswd dbname</code></p>

<p>gzip和xz压缩时后面都可以使用参数<code>-9</code>加大压缩率.但也更耗时.</p>

<p>同理还可以使用<code>bzip2</code>和<code>bzip2 -dc</code>压缩和解压</p>

<p>DELAYED仅适用于MyISAM, MEMORY和ARCHIVE表</p>

<p>replace delayed into</p>

<p>insert delayed into</p>

<p>insert delayed ignore into</p>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/ffmpeg-usage/"> ffmpeg安装使用</a>
			</h1>
			<p class="post-date">Mon, Jan 11, 2016</p>
			<div class="post-text">
				

<h2 id="编译安装">编译安装</h2>

<pre><code>yum install autoconf automake cmake freetype-devel gcc gcc-c++ git libtool make mercurial nasm pkgconfig zlib-devel
mkdir ~/ffmpeg_sources
</code></pre>

<p>Yasm is an assembler used by x264 and FFmpeg</p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 git://github.com/yasm/yasm.git
cd yasm
autoreconf -fiv
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --bindir=&quot;$HOME/bin&quot;
make
make install
make distclean
</code></pre>

<p>H.264 video encoder.
Requires ffmpeg to be configured with <code>--enable-gpl --enable-libx264</code></p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 git://git.videolan.org/x264
cd x264
PKG_CONFIG_PATH=&quot;$HOME/ffmpeg_build/lib/pkgconfig&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --bindir=&quot;$HOME/bin&quot; --enable-static
make
make install
make distclean
</code></pre>

<p>H.265/HEVC video encoder. Requires ffmpeg to be configured with <code>--enable-gpl --enable-libx265</code></p>

<pre><code>cd ~/ffmpeg_sources
hg clone https://bitbucket.org/multicoreware/x265
cd ~/ffmpeg_sources/x265/build/linux
cmake -G &quot;Unix Makefiles&quot; -DCMAKE_INSTALL_PREFIX=&quot;$HOME/ffmpeg_build&quot; -DENABLE_SHARED:bool=off ../../source
make
make install
</code></pre>

<p>AAC audio encoder. Requires ffmpeg to be configured with <code>--enable-libfdk-aac</code> (and <code>--enable-nonfree</code> if you also included <code>--enable-gpl</code>)</p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 git://git.code.sf.net/p/opencore-amr/fdk-aac
cd fdk-aac
autoreconf -fiv
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>MP3 audio encoder. Requires ffmpeg to be configured with <code>--enable-libmp3lame</code></p>

<pre><code>cd ~/ffmpeg_sources
curl -L -O http://downloads.sourceforge.net/project/lame/lame/3.99/lame-3.99.5.tar.gz
tar xzvf lame-3.99.5.tar.gz
cd lame-3.99.5
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --bindir=&quot;$HOME/bin&quot; --disable-shared --enable-nasm
make
make install
make distclean
</code></pre>

<p>Opus audio decoder and encoder. Requires ffmpeg to be configured with <code>--enable-libopus</code></p>

<pre><code>cd ~/ffmpeg_sources
git clone git://git.opus-codec.org/opus.git
cd opus
autoreconf -fiv
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>Ogg bitstream library. Required by libtheora and libvorbis.</p>

<pre><code>cd ~/ffmpeg_sources
curl -O http://downloads.xiph.org/releases/ogg/libogg-1.3.2.tar.gz
tar xzvf libogg-1.3.2.tar.gz
cd libogg-1.3.2
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>Vorbis audio encoder. Requires libogg. Requires ffmpeg to be configured with <code>--enable-libvorbis</code></p>

<pre><code>cd ~/ffmpeg_sources
curl -O http://downloads.xiph.org/releases/vorbis/libvorbis-1.3.4.tar.gz
tar xzvf libvorbis-1.3.4.tar.gz
cd libvorbis-1.3.4
LDFLAGS=&quot;-L$HOME/ffmeg_build/lib&quot; CPPFLAGS=&quot;-I$HOME/ffmpeg_build/include&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --with-ogg=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>VP8/VP9 video encoder. Requires ffmpeg to be configured with <code>--enable-libvpx</code></p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 https://chromium.googlesource.com/webm/libvpx.git
cd libvpx
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-examples
make
make install
make clean
</code></pre>

<p>Compilation is now complete and ffmpeg (also ffprobe, ffserver, lame, and x264) should now be ready to use.</p>

<pre><code>cd ~/ffmpeg_sources
git clone https://github.com/FFmpeg/FFmpeg ffmpeg
cd ffmpeg
PKG_CONFIG_PATH=&quot;$HOME/ffmpeg_build/lib/pkgconfig&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --extra-cflags=&quot;-I$HOME/ffmpeg_build/include&quot; --extra-ldflags=&quot;-L$HOME/ffmpeg_build/lib&quot; --bindir=&quot;$HOME/bin&quot; --pkg-config-flags=&quot;--static&quot; --enable-gpl --enable-nonfree --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265
make -j4
make install
make distclean
hash -r
</code></pre>

<p>生成的可执行文件存放在<code>~/bin</code></p>

<h2 id="下载官方的静态编译的linux通用二进制包-同时也包含arm版本的">下载官方的静态编译的Linux通用二进制包,同时也包含ARM版本的</h2>

<p><a href="http://johnvansickle.com/ffmpeg/">ffmpeg</a></p>

<p>Windows版本也提供编译好的下载</p>

<p><a href="https://ffmpeg.zeranoe.com/builds/">https://ffmpeg.zeranoe.com/builds/</a></p>

<p>Mac编译好的下载(FFmpeg,FFserver,FFprobe,FFplay)</p>

<p><a href="http://evermeet.cx/ffmpeg/">http://evermeet.cx/ffmpeg/</a></p>

<p>使用brew安装
<code>brew install ffmpeg --with-ffplay</code></p>

<p>让ffmpeg转为MP4边下边播</p>

<p><code>ffmpeg -i input.xxoo -c copy -movflags faststart output.mp4</code></p>

<p>flv to mp4</p>

<p><code>ffmpeg -i input.flv -codec copy output.mp4</code> 快速转化flv到mp4,高质量转化( only changes container without reencoding )</p>

<p><code>ffmpeg -i input.flv -c copy -copyts output.mp4</code> 也比较快,高质量转化</p>

<p><code>ffmpeg -i aaa.flv -c:v libx264 -crf 28 output.mp4</code> 带压缩的转换,非常消耗CPU和时间</p>

<p>更多用法可以参考 <a href="http://www.jianshu.com/p/053665062f22">http://www.jianshu.com/p/053665062f22</a></p>

<p>处理m3u8地址视频</p>

<p>下载转码 <code>ffmpeg -i &quot;http://m3u8的地址&quot;&quot; -c copy -bsf:a aac_adtstoasc output.mp4</code></p>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/git-usage/"> git基本使用</a>
			</h1>
			<p class="post-date">Fri, Jan 8, 2016</p>
			<div class="post-text">
				

<h1 id="git配置">git配置</h1>

<pre><code>git config --global user.email &quot;1126045770@qq.com&quot;
git config --global user.name &quot;sucongohu&quot;

git config --global core.autocrlf false
git config --global color.ui true
git config --global credential.helper store

git config --global alias.lg &quot;log --graph --all --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%ci,%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative&quot;
</code></pre>

<blockquote>
<p>以上分别是设置用户信息,禁止转换换行符,颜色高亮,记住密码,设置别名列出分支图. 设置别名后,可以使用 <code>git lg</code> 查看各个分支关系</p>
</blockquote>

<p>使用git还经常碰到文件权限发生变化,也显示文件变动了,需要提交,如果你不想将文件权限的变动纳入版本控制可以</p>

<pre><code>git config core.filemode false
</code></pre>

<p>对于一些本地和服务器不一致的配置文件,<code>git status</code>每次查看都显示出来,<code>git add -u</code>又会一不小心提交,可以使用
<em>忽略已追踪文件的变动</em></p>

<pre><code>git update-index --assume-unchanged PATH_TO_FILE
</code></pre>

<p>参数  说明</p>

<pre><code>
%H	commit hash
%h	commit short hash
%T	tree hash
%t	tree short hash
%P	parent hash
%p	parent short hash
%an	作者名字
%aN	.mailmap 中对应的作者名字
%ae	作者邮箱
%aE	.mailmap 中对应的作者邮箱
%ad	–date=制定的日期格式
%aD	RFC2822 日期格式
%ar	日期格式，例如：1 day ago
%at	UNIX timestamp 日期格式
%ai	ISO 8601 日期格式
%cn	提交者名字
%cN	.mailmap 对应的提交的名字
%ce	提交者邮箱
%cE	.mailmap 对应的提交者的邮箱
%cd	–data=制定的提交日期的格式
%cD	RFC2822 提交日期的格式
%cr	提交日期的格式，例如：1day ago
%ct	UNIX timestamp 提交日期的格式
%ci	ISO 8601 提交日期的格式
%d	ref 名称
%e	encoding
%s	commit 信息标题
%f	过滤 commit 信息的标题使之可以作为文件名
%b	commit 信息内容
%N	commit notes
%gD	reflog selector, e.g., refs/stash@{1}
%gd	shortened reflog selector, e.g., stash@{1}
%gs	reflog subject
%Cred	切换至红色
%Cgreen	切换至绿色
%Cblue	切换至蓝色
%Creset	重设颜色
%C(color)	制定颜色，as described in color.branch.* config option
%m	left right or boundary mark
%n	换行
%%	a raw %
%x00	print a byte from a hex code
%w([[,[,]]])	switch line wrapping, like the -w option of git-shortlog(1).
</code></pre>

<p>一个命令推送到多个服务端<code>vim .git/config</code> ,添加一个区段,例如:</p>

<pre><code>[remote &quot;all&quot;]
        url = https://git.oschina.net/suconghou/mvc.git
        url = https://suconghou@git.coding.net/suconghou/mvc.git
        url = https://github.com/suconghou/mvc.git
</code></pre>

<p>以后可以使用<code>git push all master</code>一次推送到多个后端</p>

<h1 id="git分支管理">git分支管理</h1>

<h2 id="1-创建分支">1.创建分支</h2>

<blockquote>
<p>git branch &lt;分支名&gt;</p>
</blockquote>

<h2 id="2-切换到分支">2.切换到分支</h2>

<blockquote>
<p>git checkout &lt;分支名&gt;</p>
</blockquote>

<h2 id="3-创建一个分支并切换过去">3.创建一个分支并切换过去</h2>

<blockquote>
<p>git checkout -b &lt;分支名&gt;</p>
</blockquote>

<p>或者</p>

<blockquote>
<p>git checkout -b &lt;分支名&gt; master</p>
</blockquote>

<p>后面是跟一个master说明创建的develop分支是基于当前的master， 如果当前就在master分支，则可以不写。 如果当前分支HEAD指向的是别的分支，又想基于master分支创建，就必须写master</p>

<h2 id="4-分支合并">4.分支合并</h2>

<p>如:要将develop分支合并和master分支
首先切换的master分支：<code>git checkout master</code>
然后执行合并操作：<code>git merge develop</code>
如果有冲突，会提示你，调用<code>git status</code>查看冲突文件。
解决冲突，然后调用<code>git add</code>或<code>git rm</code>将解决后的文件暂存。
所有冲突解决后，<code>git commit</code>提交更改。</p>

<h2 id="5-删除分支">5.删除分支</h2>

<p>删除本地分支,删除分支之前记得先合并,以免数据丢失</p>

<blockquote>
<p>git branch -d &lt;分支名&gt;</p>
</blockquote>

<p><code>git push [远程名] [本地分支]:[远程分支]</code> 本地分支的数据推送到远程分支,如果远程分支不存在,将会自动创建</p>

<p>如果本地分支为空格,则将删除远程分支 <code>git push origin :deletebranch</code></p>

<h2 id="6-显示所有分支">6.显示所有分支</h2>

<blockquote>
<p>git branch -a</p>
</blockquote>

<p>显示远端分支</p>

<blockquote>
<p>git branch -r</p>
</blockquote>

<p><code>git push -all</code> 把所有本地分支都推到远端</p>

<p><code>git pull origin remotebranch:localbranch</code>
将远程某分支拉倒本地某分支,当本地分支和远程分支名称相同时，只写一个就可以</p>

<h1 id="git-tag-管理">git tag 管理</h1>

<h2 id="1-git-tag">1.git tag</h2>

<p>在控制台打印出当前仓库的所有标签</p>

<h2 id="2-git-tag-l-v0-1">2.git tag -l &lsquo;v0.1.*&rsquo;</h2>

<p>搜索符合模式的标签</p>

<h2 id="3-git-tag-v0-1-2-light">3.git tag v0.1.2-light</h2>

<p>创建轻量标签</p>

<h2 id="4-git-tag-a-v0-1-2-m-0-1-2版本">4.git tag -a v0.1.2 -m &ldquo;0.1.2版本&rdquo;</h2>

<p>创建附注标签</p>

<p>git标签分为两种类型：轻量标签和附注标签。轻量标签是指向提交对象的引用，附注标签则是仓库中的一个独立对象。建议使用附注标签。</p>

<h2 id="5-git-tag-d-v0-1-2">5.git tag -d v0.1.2</h2>

<p>删除标签</p>

<h2 id="6-git-push-origin-v0-1-2">6.git push origin v0.1.2</h2>

<p>将v0.1.2标签提交到git服务器
git push origin –-tags
将本地所有标签一次性提交到git服务器
通常的git push不会将标签对象提交到git服务器，所以我们需要进行显式的操作：</p>

<h1 id="git-stash-操作">git stash 操作</h1>

<p>1.git stash 可用来暂存当前正在进行的工作， 比如想pull 最新代码， 又不想加新commit， 或者另外一种情况，为了fix 一个紧急的bug,  先stash, 使返回到自己上一个commit, 改完bug之后再stash pop, 继续原来的工作。</p>

<pre><code>git stash
//do some work
git stash pop
</code></pre>

<p>2.同样可以使用 git stash save &ldquo;work in progress for foo feature&rdquo; 添加标记</p>

<p>3.当你多次使用<code>git stash</code>命令后，你的栈里将充满了未提交的代码，这时候你会对将哪个版本应用回来有些困惑，
<code>git stash list</code> 命令可以将当前的Git栈信息打印出来，你只需要将找到对应的版本号，例如使用<code>git stash apply stash@{1}</code>就可以将你指定版本号为stash@{1}的工作取出来，当你将所有的栈都应用回来的时候，可以使用<code>git stash clear</code>来将栈清空。</p>

<h1 id="给git仓库瘦身">给Git仓库瘦身</h1>

<p>使用<code>git gc --aggressive</code>来整理仓库,压缩合并碎片文件能减小仓库大小.</p>

<p>使用<code>git prune</code> 删除一些不会被使用的残留数据,使用<code>git prune -n</code>可以查看将要被删除的数据.</p>

<p>如果想要更加暴力的操作git减小仓库大小,一般使用<code>git-filter-branch</code>,不过操作比较麻烦,可以参考官方的操作 <a href="http://git-scm.com/book/zh/v1/Git-内部原理-维护及数据恢复">http://git-scm.com/book/zh/v1/Git-内部原理-维护及数据恢复</a></p>

<p>这里提供一个工具<a href="https://rtyley.github.io/bfg-repo-cleaner/">https://rtyley.github.io/bfg-repo-cleaner/</a></p>

<p>使用这个操作更加方便</p>

<p>下载<code>bfg</code>jar文件,使用<code>java -jar bfg.jar</code>运行,也可以自己写一个<code>alias</code></p>

<p>首先<code>git clone --mirror 地址</code></p>

<pre><code>bfg --strip-blobs-bigger-than 10M .
</code></pre>

<p><code>bfg --strip-blobs-bigger-than 1M --delete-files '{*.jar,*.zip,*.gz,*.war,*.jpg,*.png,*.jpeg}'</code></p>

<p>最后执行<code>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive</code></p>

<p>使用<code>du -sh</code>查看最终文件夹大小.</p>

<h1 id="git打包">git打包</h1>

<p>时常我们会使用<code>github</code>或者其他git托管网站的下载zip包功能,下载的压缩包仅包含仓库里的现有文件,不含<code>.git</code>文件夹</p>

<p>那么我们本地的仓库如何做到呢,需要自己使用<code>zip</code>命令自己压缩排除文件吗.</p>

<p>其实git已经自带这个功能了,可以将任意版本的数据导出为压缩包.</p>

<p>将 master以zip格式打包到指定文件<code>git archive --format zip --output /path/to/file.zip master</code></p>

<pre><code>git archive v0.1 | gzip &gt; site.tgz
git archive master &gt; ./fds.zip
</code></pre>

<p>最快捷的直接使用<code>git archive master -o a.tgz</code></p>

<p>使用 -o a.tgz 或者 a.tar.gz 生成gzip格式的, -o a.zip 生成zip格式的.</p>

<p><img src="http://static.suconghou.cn/document/git-usage.jpg" alt="git-usage" /></p>

<h1 id="从源码静态编译git">从源码静态编译git</h1>

<pre><code>apk update &amp;&amp; apk upgrade
apk add curl gcc g++ make zlib-dev perl
curl https://www.kernel.org/pub/software/scm/git/git-2.10.2.tar.xz | tar xJ
cd git-2.10.2
./configure --prefix=/usr/local --with-curl   CFLAGS=&quot;${CFLAGS} -Os -static `pkg-config --static --libs libcurl`&quot;  NO_TCLTK=1 NO_PERL=1 NO_GETTEXT=1
make -j4
make install

</code></pre>

<h1 id="svn">svn</h1>

<p><code>svn revert xx.html</code> 和<code>git checkout xx.html</code> 类似,还原文件的更改</p>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/sublime-usage/"> Sublime使用和设置</a>
			</h1>
			<p class="post-date">Fri, Jan 8, 2016</p>
			<div class="post-text">
				

<h2 id="配置文件">配置文件</h2>

<p>最喜欢的字体<code>Monaco</code>,<a href="http://share.suconghou.cn/fonts/MONACO.TTF">此处下载</a></p>

<p>配置文件
<code>Preferences.sublime-settings</code></p>

<pre><code>{
	&quot;close_windows_when_empty&quot;: true,
	&quot;default_encoding&quot;: &quot;UTF-8&quot;,
	&quot;default_line_ending&quot;: &quot;unix&quot;,
	&quot;ensure_newline_at_eof_on_save&quot;: true,
	&quot;font_face&quot;: &quot;Monaco&quot;,
	&quot;font_size&quot;: 13,
	&quot;highlight_line&quot;: true,
	&quot;highlight_modified_tabs&quot;: true,
	&quot;ignored_packages&quot;:
	[
		&quot;Vintage&quot;
	],
	&quot;show_encoding&quot;: true,
	&quot;show_line_endings&quot;: true,
	&quot;tab_size&quot;: 4,
	&quot;translate_tabs_to_spaces&quot;: false,
	&quot;trim_trailing_white_space_on_save&quot;: true,
	&quot;update_check&quot;: false,
	&quot;word_wrap&quot;: false
}
</code></pre>

<h2 id="插件">插件</h2>

<p><code>open_browser.py</code> 插件</p>

<pre><code>import sublime, sublime_plugin
import webbrowser
import os

url_map = {
    'D:\\git\\bbs\\' : 'http://127.0.0.3/',
    'D:\\php\\su\\' : 'http://127.0.0.2/',
    'D:\\php\\htdocs\\' : 'http://127.0.0.1/'
}

class OpenBrowserCommand(sublime_plugin.TextCommand):
    def run(self,edit):
        window = sublime.active_window()
        window.run_command('save')
        url = self.view.file_name()
        flag = False
        for path, domain in url_map.items():
            if url.startswith(path):
                url = url.replace(path, domain).replace('\\', '/')
                flag = True
                break
        if not flag:
            cmd1='taskkill /f /im php.exe'
            cmd2='php -S 0.0.0.0:8088 -t '+os.path.abspath(os.path.dirname(self.view.file_name()))
            os.system(cmd1)
            os.popen(cmd2)
            url =  'http://127.0.0.1:8088/'+os.path.basename(self.view.file_name())
        webbrowser.open_new(url)
</code></pre>

<h2 id="编译系统">编译系统</h2>

<p><code>node.sublime-build</code> 执行nodejs代码</p>

<pre><code>{
	&quot;shell_cmd&quot;: &quot;node ${file}&quot;
}
</code></pre>

<h2 id="快捷键配置">快捷键配置</h2>

<p><code>Default (OSX).sublime-keymap</code></p>

<pre><code>[
	{ &quot;keys&quot;: [&quot;alt+d&quot;], &quot;command&quot;: &quot;open_dir&quot;, &quot;args&quot;: {&quot;dir&quot;: &quot;$file_path&quot;, &quot;file&quot;: &quot;$file_name&quot;} },
	{ &quot;keys&quot;: [&quot;ctrl+shift+c&quot;], &quot;command&quot;: &quot;copy_path&quot; },
	{ &quot;keys&quot;: [&quot;ctrl+f11&quot;], &quot;command&quot;: &quot;toggle_distraction_free&quot; }
]
</code></pre>

<h2 id="添加sublime到命令行">添加sublime到命令行</h2>

<p><code>MacOs</code>下</p>

<pre><code>ln -s /Applications/Sublime\ Text.app/Contents/SharedSupport/bin/subl /usr/local/bin/sublime
</code></pre>

<h2 id="激活码">激活码</h2>

<p>3103可用激活码</p>

<pre><code>—– BEGIN LICENSE —–
Ryan Clark
Single User License
EA7E-812479
2158A7DE B690A7A3 8EC04710 006A5EEB
34E77CA3 9C82C81F 0DB6371B 79704E6F
93F36655 B031503A 03257CCC 01B20F60
D304FA8D B1B4F0AF 8A76C7BA 0FA94D55
56D46BCE 5237A341 CD837F30 4D60772D
349B1179 A996F826 90CDB73C 24D41245
FD032C30 AD5E7241 4EAA66ED 167D91FB
55896B16 EA125C81 F550AF6B A6820916
—— END LICENSE ——
</code></pre>

<p>3103之前版本可用</p>

<pre><code>----- BEGIN LICENSE -----
Andrew Weber
Single User License
EA7E-855605
813A03DD 5E4AD9E6 6C0EEB94 BC99798F
942194A6 02396E98 E62C9979 4BB979FE
91424C9D A45400BF F6747D88 2FB88078
90F5CC94 1CDC92DC 8457107A F151657B
1D22E383 A997F016 42397640 33F41CFC
E1D0AE85 A0BBD039 0E9C8D55 E1B89D5D
5CDB7036 E56DE1C0 EFCC0840 650CD3A6
B98FC99C 8FAC73EE D2B95564 DF450523
------ END LICENSE ------
</code></pre>

			</div>
		</div>
		
	</div>
	<nav>
		
    
    <ul class="pagination">
        
        <li>
            <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
        </li>
        
        <li
        >
        <a href="/page/5/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
        </li>
        
        <li
        ><a href="/">1</a></li>
        
        <li
        ><a href="/page/2/">2</a></li>
        
        <li
        ><a href="/page/3/">3</a></li>
        
        <li
        ><a href="/page/4/">4</a></li>
        
        <li
        ><a href="/page/5/">5</a></li>
        
        <li
        class="active"><a href="/page/6/">6</a></li>
        
        <li
        ><a href="/page/7/">7</a></li>
        
        <li
        ><a href="/page/8/">8</a></li>
        
        <li
        >
        <a href="/page/7/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
        </li>
        
        <li>
            <a href="/page/8/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
        </li>
        
    </ul>
    
	</nav>
</div>
	<div class="music-container">
	<div class="music-header">
	    <a class="fa-button home" href="javascript:music.show(0)"><i class="fa fa-home" title="Home"></i></a>
	    <a class="fa-button next" href="javascript:music.next()"><i class="fa fa-chevron-right" title="Next"></i></a>
	</div>
	<div class="backdrop"></div>
	<div class="music-player">
		<div class="cover">
            <img src="http://p4.music.126.net/ckfEE9UUGcnGHylQJ12ENA==/670702092966093.jpg?param=350y350">
            <div class="foredrag"><i class="fa fa-play"></i></div>
        </div>
        <div class="progress">
            <div class="elapse"></div>
        </div>
        <div class="detail">
            <div class="title">音乐标题</div>
            <div class="artist">歌手</div>
        </div>
	</div>
</div>
<div id="loader" style="z-index:99999;" class="pageload-overlay" data-opening="M 40 -21.875 C 11.356078 -21.875 -11.875 1.3560784 -11.875 30 C -11.875 58.643922 11.356078 81.875 40 81.875 C 68.643922 81.875 91.875 58.643922 91.875 30 C 91.875 1.3560784 68.643922 -21.875 40 -21.875 Z">
    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 80 60" preserveAspectRatio="xMidYMid slice"> <path d="M40,30 c 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 Z"/></svg>
</div>

	<footer class="footer">
		<div class="footer-nav">
			<ul>
				<li><a href="/post/">归档</a></li>
				<li><a href="/">专题</a></li>
				<li><a href="/life/">生活</a></li>
				<li><a href="/about/">关于</a></li>
			</ul>
		</div>
	</footer>
	<script type="text/javascript" src="/js/main.min.js" data-no-instant></script>
</body>
</html>

