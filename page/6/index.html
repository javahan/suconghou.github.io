<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="generator" content="Hugo 0.17" />
	<meta charset="UTF-8">
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='renderer' content='webkit'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no'>
	<meta name='description' content='记录学习的点点滴滴'>
	<meta name='keywords' content='前端,PHP,GO,编程博客'>
	<title>苏苏的博客 &middot; 苏苏的博客</title>
	<link rel="stylesheet" type="text/css" href="/css/style.min.css">
	<link href="http://blog.suconghou.cn/index.xml" rel="alternate" type="application/rss+xml" title="苏苏的博客" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
	<link rel="shortcut icon" href="/favicon.png">
</head>
<body>
<header class="header">
	<div class="header-main">
		<a href="/"><img src="/img/avatar.jpg" class="header-avatar"></a>
		<h1>苏苏的博客</h1>
		<p class="sub-title">简约至极</p>
		<ul class="contact">
			<a href="https://github.com/suconghou" target="_blank"><i class="fa fa-github"></i></a>
			<a href="javascript:music.show(1)"><i class="fa fa-music"></i></a>
		</ul>
	</div>
</header>

<aside></aside>

<div class="content container">
	<div class="posts">
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/ffmpeg-usage/"> ffmpeg安装使用</a>
			</h1>
			<p class="post-date">Mon, Jan 11, 2016</p>
			<div class="post-text">
				

<h2 id="编译安装">编译安装</h2>

<pre><code>yum install autoconf automake cmake freetype-devel gcc gcc-c++ git libtool make mercurial nasm pkgconfig zlib-devel
mkdir ~/ffmpeg_sources
</code></pre>

<p>Yasm is an assembler used by x264 and FFmpeg</p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 git://github.com/yasm/yasm.git
cd yasm
autoreconf -fiv
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --bindir=&quot;$HOME/bin&quot;
make
make install
make distclean
</code></pre>

<p>H.264 video encoder.
Requires ffmpeg to be configured with <code>--enable-gpl --enable-libx264</code></p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 git://git.videolan.org/x264
cd x264
PKG_CONFIG_PATH=&quot;$HOME/ffmpeg_build/lib/pkgconfig&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --bindir=&quot;$HOME/bin&quot; --enable-static
make
make install
make distclean
</code></pre>

<p>H.265/HEVC video encoder. Requires ffmpeg to be configured with <code>--enable-gpl --enable-libx265</code></p>

<pre><code>cd ~/ffmpeg_sources
hg clone https://bitbucket.org/multicoreware/x265
cd ~/ffmpeg_sources/x265/build/linux
cmake -G &quot;Unix Makefiles&quot; -DCMAKE_INSTALL_PREFIX=&quot;$HOME/ffmpeg_build&quot; -DENABLE_SHARED:bool=off ../../source
make
make install
</code></pre>

<p>AAC audio encoder. Requires ffmpeg to be configured with <code>--enable-libfdk-aac</code> (and <code>--enable-nonfree</code> if you also included <code>--enable-gpl</code>)</p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 git://git.code.sf.net/p/opencore-amr/fdk-aac
cd fdk-aac
autoreconf -fiv
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>MP3 audio encoder. Requires ffmpeg to be configured with <code>--enable-libmp3lame</code></p>

<pre><code>cd ~/ffmpeg_sources
curl -L -O http://downloads.sourceforge.net/project/lame/lame/3.99/lame-3.99.5.tar.gz
tar xzvf lame-3.99.5.tar.gz
cd lame-3.99.5
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --bindir=&quot;$HOME/bin&quot; --disable-shared --enable-nasm
make
make install
make distclean
</code></pre>

<p>Opus audio decoder and encoder. Requires ffmpeg to be configured with <code>--enable-libopus</code></p>

<pre><code>cd ~/ffmpeg_sources
git clone git://git.opus-codec.org/opus.git
cd opus
autoreconf -fiv
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>Ogg bitstream library. Required by libtheora and libvorbis.</p>

<pre><code>cd ~/ffmpeg_sources
curl -O http://downloads.xiph.org/releases/ogg/libogg-1.3.2.tar.gz
tar xzvf libogg-1.3.2.tar.gz
cd libogg-1.3.2
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>Vorbis audio encoder. Requires libogg. Requires ffmpeg to be configured with <code>--enable-libvorbis</code></p>

<pre><code>cd ~/ffmpeg_sources
curl -O http://downloads.xiph.org/releases/vorbis/libvorbis-1.3.4.tar.gz
tar xzvf libvorbis-1.3.4.tar.gz
cd libvorbis-1.3.4
LDFLAGS=&quot;-L$HOME/ffmeg_build/lib&quot; CPPFLAGS=&quot;-I$HOME/ffmpeg_build/include&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --with-ogg=&quot;$HOME/ffmpeg_build&quot; --disable-shared
make
make install
make distclean
</code></pre>

<p>VP8/VP9 video encoder. Requires ffmpeg to be configured with <code>--enable-libvpx</code></p>

<pre><code>cd ~/ffmpeg_sources
git clone --depth 1 https://chromium.googlesource.com/webm/libvpx.git
cd libvpx
./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --disable-examples
make
make install
make clean
</code></pre>

<p>Compilation is now complete and ffmpeg (also ffprobe, ffserver, lame, and x264) should now be ready to use.</p>

<pre><code>cd ~/ffmpeg_sources
git clone https://github.com/FFmpeg/FFmpeg ffmpeg
cd ffmpeg
PKG_CONFIG_PATH=&quot;$HOME/ffmpeg_build/lib/pkgconfig&quot; ./configure --prefix=&quot;$HOME/ffmpeg_build&quot; --extra-cflags=&quot;-I$HOME/ffmpeg_build/include&quot; --extra-ldflags=&quot;-L$HOME/ffmpeg_build/lib&quot; --bindir=&quot;$HOME/bin&quot; --pkg-config-flags=&quot;--static&quot; --enable-gpl --enable-nonfree --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265
make -j4
make install
make distclean
hash -r
</code></pre>

<p>生成的可执行文件存放在<code>~/bin</code></p>

<h2 id="下载官方的静态编译的linux通用二进制包-同时也包含arm版本的">下载官方的静态编译的Linux通用二进制包,同时也包含ARM版本的</h2>

<p><a href="http://johnvansickle.com/ffmpeg/">ffmpeg</a></p>

<p>Windows版本也提供编译好的下载</p>

<p><a href="https://ffmpeg.zeranoe.com/builds/">https://ffmpeg.zeranoe.com/builds/</a></p>

<p>Mac编译好的下载(FFmpeg,FFserver,FFprobe,FFplay)</p>

<p><a href="http://evermeet.cx/ffmpeg/">http://evermeet.cx/ffmpeg/</a></p>

<p>使用brew安装
<code>brew install ffmpeg --with-ffplay</code></p>

<p>让ffmpeg转为MP4边下边播</p>

<p><code>ffmpeg -i input.xxoo -c copy -movflags faststart output.mp4</code></p>

<p>flv to mp4</p>

<p><code>ffmpeg -i input.flv -codec copy output.mp4</code> 快速转化flv到mp4,高质量转化( only changes container without reencoding )</p>

<p><code>ffmpeg -i input.flv -c copy -copyts output.mp4</code> 也比较快,高质量转化</p>

<p><code>ffmpeg -i aaa.flv -c:v libx264 -crf 28 output.mp4</code> 带压缩的转换,非常消耗CPU和时间</p>

<p>更多用法可以参考 <a href="http://www.jianshu.com/p/053665062f22">http://www.jianshu.com/p/053665062f22</a></p>

<p>处理m3u8地址视频</p>

<p>下载转码 <code>ffmpeg -i &quot;http://m3u8的地址&quot;&quot; -c copy -bsf:a aac_adtstoasc output.mp4</code></p>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/git-usage/"> git基本使用</a>
			</h1>
			<p class="post-date">Fri, Jan 8, 2016</p>
			<div class="post-text">
				

<h1 id="git配置">git配置</h1>

<pre><code>git config --global user.email &quot;1126045770@qq.com&quot;
git config --global user.name &quot;sucongohu&quot;

git config --global core.autocrlf false
git config --global color.ui true
git config --global credential.helper store

git config --global alias.lg &quot;log --graph --all --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%ci,%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative&quot;
</code></pre>

<blockquote>
<p>以上分别是设置用户信息,禁止转换换行符,颜色高亮,记住密码,设置别名列出分支图. 设置别名后,可以使用 <code>git lg</code> 查看各个分支关系</p>
</blockquote>

<p>使用git还经常碰到文件权限发生变化,也显示文件变动了,需要提交,如果你不想将文件权限的变动纳入版本控制可以</p>

<pre><code>git config core.filemode false
</code></pre>

<p>对于一些本地和服务器不一致的配置文件,<code>git status</code>每次查看都显示出来,<code>git add -u</code>又会一不小心提交,可以使用
<em>忽略已追踪文件的变动</em></p>

<pre><code>git update-index --assume-unchanged PATH_TO_FILE
</code></pre>

<p>参数  说明</p>

<pre><code>
%H	commit hash
%h	commit short hash
%T	tree hash
%t	tree short hash
%P	parent hash
%p	parent short hash
%an	作者名字
%aN	.mailmap 中对应的作者名字
%ae	作者邮箱
%aE	.mailmap 中对应的作者邮箱
%ad	–date=制定的日期格式
%aD	RFC2822 日期格式
%ar	日期格式，例如：1 day ago
%at	UNIX timestamp 日期格式
%ai	ISO 8601 日期格式
%cn	提交者名字
%cN	.mailmap 对应的提交的名字
%ce	提交者邮箱
%cE	.mailmap 对应的提交者的邮箱
%cd	–data=制定的提交日期的格式
%cD	RFC2822 提交日期的格式
%cr	提交日期的格式，例如：1day ago
%ct	UNIX timestamp 提交日期的格式
%ci	ISO 8601 提交日期的格式
%d	ref 名称
%e	encoding
%s	commit 信息标题
%f	过滤 commit 信息的标题使之可以作为文件名
%b	commit 信息内容
%N	commit notes
%gD	reflog selector, e.g., refs/stash@{1}
%gd	shortened reflog selector, e.g., stash@{1}
%gs	reflog subject
%Cred	切换至红色
%Cgreen	切换至绿色
%Cblue	切换至蓝色
%Creset	重设颜色
%C(color)	制定颜色，as described in color.branch.* config option
%m	left right or boundary mark
%n	换行
%%	a raw %
%x00	print a byte from a hex code
%w([[,[,]]])	switch line wrapping, like the -w option of git-shortlog(1).
</code></pre>

<p>一个命令推送到多个服务端<code>vim .git/config</code> ,添加一个区段,例如:</p>

<pre><code>[remote &quot;all&quot;]
        url = https://git.oschina.net/suconghou/mvc.git
        url = https://suconghou@git.coding.net/suconghou/mvc.git
        url = https://github.com/suconghou/mvc.git
</code></pre>

<p>以后可以使用<code>git push all master</code>一次推送到多个后端</p>

<h1 id="git分支管理">git分支管理</h1>

<h2 id="1-创建分支">1.创建分支</h2>

<blockquote>
<p>git branch &lt;分支名&gt;</p>
</blockquote>

<h2 id="2-切换到分支">2.切换到分支</h2>

<blockquote>
<p>git checkout &lt;分支名&gt;</p>
</blockquote>

<h2 id="3-创建一个分支并切换过去">3.创建一个分支并切换过去</h2>

<blockquote>
<p>git checkout -b &lt;分支名&gt;</p>
</blockquote>

<p>或者</p>

<blockquote>
<p>git checkout -b &lt;分支名&gt; master</p>
</blockquote>

<p>后面是跟一个master说明创建的develop分支是基于当前的master， 如果当前就在master分支，则可以不写。 如果当前分支HEAD指向的是别的分支，又想基于master分支创建，就必须写master</p>

<h2 id="4-分支合并">4.分支合并</h2>

<p>如:要将develop分支合并和master分支
首先切换的master分支：<code>git checkout master</code>
然后执行合并操作：<code>git merge develop</code>
如果有冲突，会提示你，调用<code>git status</code>查看冲突文件。
解决冲突，然后调用<code>git add</code>或<code>git rm</code>将解决后的文件暂存。
所有冲突解决后，<code>git commit</code>提交更改。</p>

<h2 id="5-删除分支">5.删除分支</h2>

<p>删除本地分支,删除分支之前记得先合并,以免数据丢失</p>

<blockquote>
<p>git branch -d &lt;分支名&gt;</p>
</blockquote>

<p><code>git push [远程名] [本地分支]:[远程分支]</code> 本地分支的数据推送到远程分支,如果远程分支不存在,将会自动创建</p>

<p>如果本地分支为空格,则将删除远程分支 <code>git push origin :deletebranch</code></p>

<h2 id="6-显示所有分支">6.显示所有分支</h2>

<blockquote>
<p>git branch -a</p>
</blockquote>

<p>显示远端分支</p>

<blockquote>
<p>git branch -r</p>
</blockquote>

<p><code>git push -all</code> 把所有本地分支都推到远端</p>

<p><code>git pull origin remotebranch:localbranch</code>
将远程某分支拉倒本地某分支,当本地分支和远程分支名称相同时，只写一个就可以</p>

<h1 id="git-tag-管理">git tag 管理</h1>

<h2 id="1-git-tag">1.git tag</h2>

<p>在控制台打印出当前仓库的所有标签</p>

<h2 id="2-git-tag-l-v0-1">2.git tag -l &lsquo;v0.1.*&rsquo;</h2>

<p>搜索符合模式的标签</p>

<h2 id="3-git-tag-v0-1-2-light">3.git tag v0.1.2-light</h2>

<p>创建轻量标签</p>

<h2 id="4-git-tag-a-v0-1-2-m-0-1-2版本">4.git tag -a v0.1.2 -m &ldquo;0.1.2版本&rdquo;</h2>

<p>创建附注标签</p>

<p>git标签分为两种类型：轻量标签和附注标签。轻量标签是指向提交对象的引用，附注标签则是仓库中的一个独立对象。建议使用附注标签。</p>

<h2 id="5-git-tag-d-v0-1-2">5.git tag -d v0.1.2</h2>

<p>删除标签</p>

<h2 id="6-git-push-origin-v0-1-2">6.git push origin v0.1.2</h2>

<p>将v0.1.2标签提交到git服务器
git push origin –-tags
将本地所有标签一次性提交到git服务器
通常的git push不会将标签对象提交到git服务器，所以我们需要进行显式的操作：</p>

<h1 id="git-stash-操作">git stash 操作</h1>

<p>1.git stash 可用来暂存当前正在进行的工作， 比如想pull 最新代码， 又不想加新commit， 或者另外一种情况，为了fix 一个紧急的bug,  先stash, 使返回到自己上一个commit, 改完bug之后再stash pop, 继续原来的工作。</p>

<pre><code>git stash
//do some work
git stash pop
</code></pre>

<p>2.同样可以使用 git stash save &ldquo;work in progress for foo feature&rdquo; 添加标记</p>

<p>3.当你多次使用<code>git stash</code>命令后，你的栈里将充满了未提交的代码，这时候你会对将哪个版本应用回来有些困惑，
<code>git stash list</code> 命令可以将当前的Git栈信息打印出来，你只需要将找到对应的版本号，例如使用<code>git stash apply stash@{1}</code>就可以将你指定版本号为stash@{1}的工作取出来，当你将所有的栈都应用回来的时候，可以使用<code>git stash clear</code>来将栈清空。</p>

<h1 id="给git仓库瘦身">给Git仓库瘦身</h1>

<p>使用<code>git gc --aggressive</code>来整理仓库,压缩合并碎片文件能减小仓库大小.</p>

<p>使用<code>git prune</code> 删除一些不会被使用的残留数据,使用<code>git prune -n</code>可以查看将要被删除的数据.</p>

<p>如果想要更加暴力的操作git减小仓库大小,一般使用<code>git-filter-branch</code>,不过操作比较麻烦,这里提供一个工具<a href="https://rtyley.github.io/bfg-repo-cleaner/">https://rtyley.github.io/bfg-repo-cleaner/</a></p>

<p>使用这个操作更加方便</p>

<p>下载<code>bfg</code>jar文件,使用<code>java -jar bfg.jar</code>运行,也可以自己写一个<code>alias</code></p>

<p>首先<code>git clone --mirror 地址</code></p>

<pre><code>bfg --strip-blobs-bigger-than 10M .
</code></pre>

<p><code>bfg --strip-blobs-bigger-than 1M --delete-files '{*.jar,*.zip,*.gz,*.war,*.jpg,*.png,*.jpeg}'</code></p>

<p>最后执行<code>git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive</code></p>

<p>使用<code>du -sh</code>查看最终文件夹大小.</p>

<h1 id="git打包">git打包</h1>

<p>时常我们会使用<code>github</code>或者其他git托管网站的下载zip包功能,下载的压缩包仅包含仓库里的现有文件,不含<code>.git</code>文件夹</p>

<p>那么我们本地的仓库如何做到呢,需要自己使用<code>zip</code>命令自己压缩排除文件吗.</p>

<p>其实git已经自带这个功能了,可以将任意版本的数据导出为压缩包.</p>

<p>将 master以zip格式打包到指定文件<code>git archive --format zip --output /path/to/file.zip master</code></p>

<pre><code>git archive v0.1 | gzip &gt; site.tgz
git archive master &gt; ./fds.zip
</code></pre>

<p>最快捷的直接使用<code>git archive master -o a.tgz</code></p>

<p>使用 -o a.tgz 或者 a.tar.gz 生成gzip格式的, -o a.zip 生成zip格式的.</p>

<p><img src="http://static.suconghou.cn/document/git-usage.jpg" alt="git-usage" /></p>

<h1 id="svn">svn</h1>

<p><code>svn revert xx.html</code> 和<code>git checkout xx.html</code> 类似,还原文件的更改</p>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/sublime-usage/"> Sublime使用和设置</a>
			</h1>
			<p class="post-date">Fri, Jan 8, 2016</p>
			<div class="post-text">
				

<h2 id="配置文件">配置文件</h2>

<p>最喜欢的字体<code>Monaco</code>,<a href="http://share.suconghou.cn/fonts/MONACO.TTF">此处下载</a></p>

<p>配置文件
<code>Preferences.sublime-settings</code></p>

<pre><code>{
	&quot;close_windows_when_empty&quot;: true,
	&quot;default_encoding&quot;: &quot;UTF-8&quot;,
	&quot;default_line_ending&quot;: &quot;unix&quot;,
	&quot;ensure_newline_at_eof_on_save&quot;: true,
	&quot;font_face&quot;: &quot;Monaco&quot;,
	&quot;font_size&quot;: 13,
	&quot;highlight_line&quot;: true,
	&quot;highlight_modified_tabs&quot;: true,
	&quot;ignored_packages&quot;:
	[
		&quot;Vintage&quot;
	],
	&quot;show_encoding&quot;: true,
	&quot;show_line_endings&quot;: true,
	&quot;tab_size&quot;: 4,
	&quot;translate_tabs_to_spaces&quot;: false,
	&quot;trim_trailing_white_space_on_save&quot;: true,
	&quot;update_check&quot;: false,
	&quot;word_wrap&quot;: false
}
</code></pre>

<h2 id="插件">插件</h2>

<p><code>open_browser.py</code> 插件</p>

<pre><code>import sublime, sublime_plugin
import webbrowser
import os

url_map = {
    'D:\\git\\bbs\\' : 'http://127.0.0.3/',
    'D:\\php\\su\\' : 'http://127.0.0.2/',
    'D:\\php\\htdocs\\' : 'http://127.0.0.1/'
}

class OpenBrowserCommand(sublime_plugin.TextCommand):
    def run(self,edit):
        window = sublime.active_window()
        window.run_command('save')
        url = self.view.file_name()
        flag = False
        for path, domain in url_map.items():
            if url.startswith(path):
                url = url.replace(path, domain).replace('\\', '/')
                flag = True
                break
        if not flag:
            cmd1='taskkill /f /im php.exe'
            cmd2='php -S 0.0.0.0:8088 -t '+os.path.abspath(os.path.dirname(self.view.file_name()))
            os.system(cmd1)
            os.popen(cmd2)
            url =  'http://127.0.0.1:8088/'+os.path.basename(self.view.file_name())
        webbrowser.open_new(url)
</code></pre>

<h2 id="编译系统">编译系统</h2>

<p><code>node.sublime-build</code> 执行nodejs代码</p>

<pre><code>{
	&quot;shell_cmd&quot;: &quot;node ${file}&quot;
}
</code></pre>

<h2 id="快捷键配置">快捷键配置</h2>

<p><code>Default (OSX).sublime-keymap</code></p>

<pre><code>[
	{ &quot;keys&quot;: [&quot;alt+d&quot;], &quot;command&quot;: &quot;open_dir&quot;, &quot;args&quot;: {&quot;dir&quot;: &quot;$file_path&quot;, &quot;file&quot;: &quot;$file_name&quot;} },
	{ &quot;keys&quot;: [&quot;ctrl+shift+c&quot;], &quot;command&quot;: &quot;copy_path&quot; },
	{ &quot;keys&quot;: [&quot;ctrl+f11&quot;], &quot;command&quot;: &quot;toggle_distraction_free&quot; }
]
</code></pre>

<h2 id="添加sublime到命令行">添加sublime到命令行</h2>

<p><code>MacOs</code>下</p>

<pre><code>ln -s /Applications/Sublime\ Text.app/Contents/SharedSupport/bin/subl /usr/local/bin/sublime
</code></pre>

<h2 id="激活码">激活码</h2>

<p>3103可用激活码</p>

<pre><code>—– BEGIN LICENSE —–
Ryan Clark
Single User License
EA7E-812479
2158A7DE B690A7A3 8EC04710 006A5EEB
34E77CA3 9C82C81F 0DB6371B 79704E6F
93F36655 B031503A 03257CCC 01B20F60
D304FA8D B1B4F0AF 8A76C7BA 0FA94D55
56D46BCE 5237A341 CD837F30 4D60772D
349B1179 A996F826 90CDB73C 24D41245
FD032C30 AD5E7241 4EAA66ED 167D91FB
55896B16 EA125C81 F550AF6B A6820916
—— END LICENSE ——
</code></pre>

<p>3103之前版本可用</p>

<pre><code>----- BEGIN LICENSE -----
Andrew Weber
Single User License
EA7E-855605
813A03DD 5E4AD9E6 6C0EEB94 BC99798F
942194A6 02396E98 E62C9979 4BB979FE
91424C9D A45400BF F6747D88 2FB88078
90F5CC94 1CDC92DC 8457107A F151657B
1D22E383 A997F016 42397640 33F41CFC
E1D0AE85 A0BBD039 0E9C8D55 E1B89D5D
5CDB7036 E56DE1C0 EFCC0840 650CD3A6
B98FC99C 8FAC73EE D2B95564 DF450523
------ END LICENSE ------
</code></pre>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/linux-ssh/"> SSH</a>
			</h1>
			<p class="post-date">Thu, Jan 7, 2016</p>
			<div class="post-text">
				

<h2 id="避免ssh自动断开连接">避免SSH自动断开连接</h2>

<p>如果有一段时间在SSH连接上无数据传输，连接就会断开,以下设定可以解决这个问题</p>

<p>方案一：在客户端设置</p>

<p><code>sudo vim /etc/ssh/ssh_config</code></p>

<p>开启 <code>ServerAliveInterval 60</code>
开启 <code>TCPKeepAlive yes</code></p>

<p>此后该系统里的用户连接SSH时，每60秒会发一个KeepAlive请求，避免被踢。</p>

<p>方案二：在服务器端设置</p>

<p><code>sudo vim /etc/ssh/sshd_config</code></p>

<p>开启<code>ClientAliveInterval 60</code>
开启 <code>TCPKeepAlive yes</code></p>

<p>如果您只想让当前的 ssh 保持连接，可以使用以下的命令：</p>

<p><code>ssh -o ServerAliveInterval=60 user@sshserver</code></p>

<h2 id="ssh隧道">ssh隧道</h2>

<h3 id="cfng参数">CfNg参数</h3>

<ul>
<li>C表示压缩数据传输</li>
<li>f表示后台用户验证,这个选项很有用,没有shell的不可登陆账号也能使用.</li>
<li>N表示不执行脚本或命令</li>
<li>g表示允许远程主机连接转发端口,往往会没有效果,需要修改<code>/etc/ssh/sshd_config</code>添加<code>gatewayports yes</code></li>
</ul>

<h3 id="l本地转发">-L本地转发</h3>

<p>-L [本地监听IP:]本地监听端口号:目标主机IP:目标端口号
(其中,“本地监听IP”可以省略，省略的话就认为是“0.0.0.0”，但为了安全性考虑，请务必使用“127.0.0.1”做为本地监听端口， 而不要使用默认的“0.0.0.0”。）</p>

<p><code>ssh -D 8080 user@host</code>
SSH会建立一个socket，去监听本地的8080端口。一旦有数据传向那个端口，就自动把它转移到SSH连接上面，发往远程主机。可以想象，如果8080端口原来是一个不加密端口，现在将变成一个加密端口。</p>

<p><code>ssh -L 2121:host2:21 host3</code>
命令中的L参数一共接受三个值，分别是&rdquo;本地端口:目标主机:目标主机端口&rdquo;，它们之间用冒号分隔。这条命令的意思，就是指定SSH绑定本地端口2121，然后指定host3将所有的数据，转发到目标主机host2的21端口（假定host2运行FTP，默认端口为21）。
这样一来，我们只要连接host1的2121端口，就等于连上了host2的21端口。</p>

<pre><code>ssh -CfNg -L 6300:127.0.0.1:1521 oracle@172.16.1.164
</code></pre>

<p>本机的6300端口就是远程主机172.16.1.164的1521端口</p>

<h3 id="r远程转发">-R远程转发</h3>

<pre><code> ssh -CfNg -R 1521:127.0.0.1:6300 oracle@172.16.1.164
</code></pre>

<p>在远程主机172.16.1.164上打开1521端口, 来映射本机的6300端口.</p>

<p><strong>在树莓派上映射ssh到外网</strong></p>

<pre><code>ssh -CfNg -R 2222:127.0.0.1:22 username@yourvps.com
</code></pre>

<p>这样就映射vps的2222端口到树莓派上了.但是这样映射的是服务器的127.0.0.1:2222,外网无法连接这个2222端口</p>

<p>如果你自己的服务器连接时需要端口可以在最后加上 <code>-p port</code> 指定ssh的端口</p>

<p>可以在服务器上执行<code>netstat -anltp</code>查看,这样要先登陆到自己的vps才能通过2222访问树莓派.</p>

<p>可以使用</p>

<pre><code>ssh -CfNg -R 0.0.0.0:2222:127.0.0.1:22 username@yourvps.com
</code></pre>

<p>再在服务器上配置<code>/etc/ssh/sshd_config</code></p>

<pre><code>#增加下面一句
GatewayPorts yes
#如果有
GatewayPorts no
#则改为
GatewayPorts yes
#然后重启ssh
#centos7： systemctl restart sshd
#centos6： service sshd restart
#ubuntu:   service ssh restart
</code></pre>

<p>使用<code>netstat -anltp</code>查看,监听的已经是<code>0.0.0.0</code>了,不过即使你指定-R参数<code>127.0.0.1:2222</code>,也不会监听<code>127.0.0.1</code>而始终是<code>0.0.0.0</code></p>

<p>若没有<code>netstat</code>可考虑安装<code>yum install lsof net-tools</code></p>

<h3 id="使用socks5代理">使用socks5代理</h3>

<pre><code>alias socksproxy=&quot;ssh -NT -f -D 0.0.0.0:1090  -p 1234 root@host&quot;;
</code></pre>

<p>-N 不打开远程的shell
-T 不分配tty
-f 后台运行</p>

<p>执行<code>socksproxy</code>后就建立了一条ssh socks5 proxy,本地使用127.0.0.1:1090就可以使用服务器中转流量.</p>

<h3 id="ssh-服务">ssh 服务</h3>

<p><code>chkconfig --list</code>可以查看所有服务是否开机启动等.</p>

<p><code>chkconfig --list sshd</code>可以单独查看sshd服务的启动状态</p>

<p><code>/var/empty/sshd</code>文件夹是sshd所必须的,不能被删除否则ssh服务将无法启动</p>

<p><code>chkconfig sshd on</code>将其设置为开机启动</p>

<p>CentOS7 用<code>systemctl</code>取代了<code>service</code>
旧版本的 <code>chkconfig docker on</code> 改为 <code>systemctl enable docker</code></p>

<h3 id="编译openssh">编译openssh</h3>

<p>在alpine中编译openssh,镜像地址 <a href="http://ftp.jaist.ac.jp/pub/OpenBSD/OpenSSH/portable/">http://ftp.jaist.ac.jp/pub/OpenBSD/OpenSSH/portable/</a></p>

<p>编译完成后得到一些工具,如<code>scp</code>,<code>sftp-server</code>,<code>ssh</code>,<code>sshd</code>等等</p>

<pre><code>apk update &amp;&amp; apk upgrade
apk --update add make gcc g++ zlib-dev openssl-dev
cd /tmp
OPENSSH_VERSION=openssh-7.3p1
CPU_NUM=`cat /proc/cpuinfo | grep processor | wc -l`
curl http://ftp.jaist.ac.jp/pub/OpenBSD/OpenSSH/portable/${OPENSSH_VERSION}.tar.gz | tar xz
cd ${OPENSSH_VERSION}
export CFLAGS=&quot;-O3&quot;
./configure
make -j$CPU_NUM &amp;&amp; make install
</code></pre>

<p>我编译好的二进制文件,能直接用于alpine系统</p>

<p><a href="http://share.suconghou.cn/bin/ssh.xz">ssh</a></p>

<p><a href="http://share.suconghou.cn/bin/sshd.xz">sshd</a></p>

<p>编译出来的这些工具的合集</p>

<p><a href="http://share.suconghou.cn/bin/sshbin.tar.gz">sshbin</a></p>

<p><a href="http://share.suconghou.cn/bin/sshtool.tar.gz">sshtool</a></p>

<p>配合Linux<code>adduser</code>,可以ssh到docker中</p>

<p><code>curl -o /usr/local/bin/sshd.xz http://share.suconghou.cn/bin/sshd.xz</code></p>

<p>sshd运行不能直接执行sshd,需要执行<code>/usr/local/bin/sshd</code></p>

<p>配置文件为<code>/usr/local/etc/sshd_config</code>,同时还需要几个密匙文件.</p>

<pre><code>curl -o /usr/local/bin/sshd.xz http://share.suconghou.cn/bin/sshd.xz
xz -d /usr/local/bin/sshd.xz
chmod +x /usr/local/bin/sshd
mkdir -p /usr/local/etc/
touch /usr/local/etc/sshd_config
ssh-keygen -t dsa -f /usr/local/etc/ssh_host_dsa_key -N ''
ssh-keygen -t rsa -f /usr/local/etc/ssh_host_rsa_key -N ''
ssh-keygen -t ecdsa -f /usr/local/etc/ssh_host_ecdsa_key -N ''
ssh-keygen -t ed25519 -f /usr/local/etc/ssh_host_ed25519_key -N ''
</code></pre>

<p>添加一个用户:<code>adduser work</code> ,Alpine里是<code>adduser</code>,Linux发行版里是<code>useradd</code></p>

<p>cat /etc/passwd 可以查看所有用户的列表,只输出用户名可以<code>cat /etc/passwd |cut -f 1 -d :</code></p>

<p>看第三个参数:500以上的,就是后面建的用户了.其它则为系统的用户.</p>

<p>cat /etc/group 查看用户组</p>

<p>非交互式修改密码可以使用 chpasswd <code>echo &quot;1234&quot; | chpasswd</code></p>

<p>w 可以查看当前活跃的用户列表</p>

<p>删除用户<code>userdel</code> , 用户<code>userdel -r 用户名</code>,删除用户账户及用户主目录文件</p>

<p>没有外网IP还可以使用ssh建立一个隧道</p>

<pre><code>ssh -CfNg -R 0.0.0.0:2233:127.0.0.1:22 root@yourvps.com -p 27558

</code></pre>

<h3 id="centos7修改ssh端口">CentOS7修改ssh端口</h3>

<p>注意:修改ssh端口后,可能还是不能使用,主要原因可能是semanage</p>

<p>使用以下命令查看当前SElinux 允许的ssh端口：
semanage port -l | grep ssh</p>

<p>添加xxxx端口到 SELinux
semanage port -a -t ssh_port_t -p tcp xxxx
然后确认一下是否添加进去
semanage port -l | grep ssh
如果成功会输出
ssh_port_t                    tcp    xxxx, 22</p>

			</div>
		</div>
		
		<div class="post">
			<h1 class="post-title">
				<a href="/post/install-nodejs/"> 安装NodeJs和npm</a>
			</h1>
			<p class="post-date">Thu, Jan 7, 2016</p>
			<div class="post-text">
				

<h2 id="安装nodejs">安装NodeJs</h2>

<p>nodejs官方提供了编译好的二进制的包,全平台都有,十分方便
<a href="https://nodejs.org/download/release/latest/">最新版本NodeJs官方库</a></p>

<p>其他信息<a href="http://www.oschina.net/news/73974/node-v6-2-1-current">http://www.oschina.net/news/73974/node-v6-2-1-current</a></p>

<p>例如安装Linux版本</p>

<pre><code>wget https://nodejs.org/dist/v6.0.0/node-v6.0.0-linux-x64.tar.xz
tar -xJf node-v6.0.0-linux-x64.tar.xz
sudo mv node-v6.0.0-linux-x64 /usr/local/nodejs
sudo ln -s /usr/local/nodejs/bin/node /usr/local/bin/node
sudo ln -s /usr/local/nodejs/bin/npm /usr/local/bin/npm
node -v
npm -v
</code></pre>

<h2 id="单文件版node-exe单独安装npm">单文件版node.exe单独安装npm</h2>

<p>1.clone npm 源码
<code>git clone --recursive git://github.com/isaacs/npm.git</code></p>

<p>2.进入npm目录,安装npm
<code>node cli.js install npm -gf</code></p>

<h3 id="版本切换">版本切换</h3>

<p>使用<code>n</code>来管理node的版本,<code>npm install -g n</code>,小巧无依赖,仅一个文件.</p>

<p>也不会搞乱你的node_modules文件夹,node的可执行文件位置也始终不会变化.</p>

<h2 id="一些必备package">一些必备package</h2>

<pre><code>sudo npm install -g less autoprefixer express jshint uglify-js webpack react-native-cli airs
</code></pre>

<p>** npm加速 **</p>

<p>使用淘宝的npm镜像.控制台运行,或者加入你的bashrc中永久生效</p>

<pre><code>alias cnpm=&quot;npm --registry=https://registry.npm.taobao.org --cache=$HOME/.npm/.cache/cnpm --disturl=https://npm.taobao.org/dist --userconfig=$HOME/.cnpmrc&quot;;
</code></pre>

<h2 id="安装-mongodb">安装 MongoDb</h2>

<p>在<code>CentOs</code>上,yum 没有自带mongodb的源,首先我们需要添加源.</p>

<p>例如在<code>CentOs6</code>或者<code>CentOs7</code> 上,<code>vim /etc/yum.repos.d/mongodb.repo</code>
64位系统</p>

<pre><code>[mongodb]
name=MongoDB Repository
baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/
gpgcheck=0
enabled=1
</code></pre>

<p>如果是32位系统,则为</p>

<pre><code>[mongodb]
name=MongoDB Repository
baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/i686/
gpgcheck=0
enabled=1
</code></pre>

<p>然后执行<code>yum update</code> 然后 <code>yum install -y mongodb-org mongodb-org-server</code></p>

<p>安装完后就有了<code>mongo</code>和<code>mongod</code>命令了</p>

<p><code>mongostat</code></p>

<p>CentOs6上</p>

<p>启动 <code>service mongod start</code></p>

<p>查看状态 <code>service mongod status</code></p>

<p>停止 <code>service mongod stop</code></p>

<p>CentOs7上</p>

<p>启动 <code>systemctl start mongod</code></p>

<p>查看状态 <code>systemctl status mongod</code></p>

<p>停止 <code>systemctl stop mongod</code></p>

			</div>
		</div>
		
	</div>
	<nav>
		
    
    <ul class="pagination">
        
        <li>
            <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
        </li>
        
        <li
        >
        <a href="/page/5/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
        </li>
        
        <li
        ><a href="/">1</a></li>
        
        <li
        ><a href="/page/2/">2</a></li>
        
        <li
        ><a href="/page/3/">3</a></li>
        
        <li
        ><a href="/page/4/">4</a></li>
        
        <li
        ><a href="/page/5/">5</a></li>
        
        <li
        class="active"><a href="/page/6/">6</a></li>
        
        <li
        ><a href="/page/7/">7</a></li>
        
        <li
        ><a href="/page/8/">8</a></li>
        
        <li
        >
        <a href="/page/7/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
        </li>
        
        <li>
            <a href="/page/8/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
        </li>
        
    </ul>
    
	</nav>
</div>
	<div class="music-container">
	<div class="music-header">
	    <a class="fa-button home" href="javascript:music.show(0)"><i class="fa fa-home" title="Home"></i></a>
	    <a class="fa-button next" href="javascript:music.next()"><i class="fa fa-chevron-right" title="Next"></i></a>
	</div>
	<div class="backdrop"></div>
	<div class="music-player">
		<div class="cover">
            <img src="http://p4.music.126.net/ckfEE9UUGcnGHylQJ12ENA==/670702092966093.jpg?param=350y350">
            <div class="foredrag"><i class="fa fa-play"></i></div>
        </div>
        <div class="progress">
            <div class="elapse"></div>
        </div>
        <div class="detail">
            <div class="title">音乐标题</div>
            <div class="artist">歌手</div>
        </div>
	</div>
</div>
<div id="loader" style="z-index:99999;" class="pageload-overlay" data-opening="M 40 -21.875 C 11.356078 -21.875 -11.875 1.3560784 -11.875 30 C -11.875 58.643922 11.356078 81.875 40 81.875 C 68.643922 81.875 91.875 58.643922 91.875 30 C 91.875 1.3560784 68.643922 -21.875 40 -21.875 Z">
    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 80 60" preserveAspectRatio="xMidYMid slice"> <path d="M40,30 c 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 0,0 Z"/></svg>
</div>

	<footer class="footer">
		<div class="footer-nav">
			<ul>
				<li><a href="/post/">归档</a></li>
				<li><a href="/">专题</a></li>
				<li><a href="/life/">生活</a></li>
				<li><a href="/about/">关于</a></li>
			</ul>
		</div>
	</footer>
	<script type="text/javascript" src="/js/main.min.js" data-no-instant></script>
</body>
</html>

